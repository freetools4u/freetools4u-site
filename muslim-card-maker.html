<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Muslim Identity Card Generator - Islamicpedia.blog</title>
<meta name="description" content="Create your personalized Muslim Identity Card with name, meaning, Quran mention, role, traits, favorite verse, and profile image. Stylish, shareable, and Islamic-themed." />

<!-- Google Fonts: Scheherazade New for Arabic, Montserrat for modern touch, Playfair Display for elegance -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">

<!-- Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
  /* --- CSS Variables (Enhanced) --- */
  :root {
    --primary-color: #0b3d91; /* Deep Blue */
    --secondary-color: #0a74da; /* Lighter Blue */
    --accent-color: #e2a500; /* Golden */
    --light-accent-color: #ffd700; /* Brighter Gold */
    --bg-color: #f0f2f5; /* Light Gray Background */
    --card-bg-gradient-start: #fdfdfd; /* White Card Background Gradient Start */
    --card-bg-gradient-end: #f9f9f9;   /* White Card Background Gradient End */
    --text-color: #333; /* Darker Text */
    --text-muted: #6c757d;
    --border-color: #ddd; /* Light Border */
    --shadow-color: rgba(0, 0, 0, 0.1);
    --hover-shadow: rgba(0, 0, 0, 0.15);

    /* Islamic Pattern Background (subtle geometric) - Now to be applied directly */
    --islamic-pattern: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="%23e8e8e8" d="M0 0h20v20H0z"/><path fill="%23dcdcdc" d="M10 0L0 10l10 10 10-10L10 0zM2 10L10 2l8 8-8 8L2 10z"/><path fill="%23f0f0f0" d="M10 4.472L4.472 10 10 15.528 15.528 10 10 4.472z"/></svg>');
    --islamic-pattern-opacity: 0.1;
  }

  /* --- Base Styles --- */
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0; padding: 0;
    font-family: 'Montserrat', sans-serif;
    background: var(--bg-color) var(--islamic-pattern); /* Subtle pattern background */
    color: var(--text-color);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start; /* Align to top initially */
    padding: 30px 20px;
    line-height: 1.6;
  }

  main {
    width: 100%;
    max-width: 680px; /* Slightly wider main container */
    background: var(--card-bg-gradient-start); /* Simpler background for main */
    border-radius: 15px;
    box-shadow: 0 15px 40px var(--shadow-color);
    padding: 40px 50px 60px;
    position: relative; /* For progress bar */
    overflow: hidden; /* For rounded corners with inner pattern */
  }

  h1.main-header-arabic {
    font-family: 'Scheherazade New', serif;
    font-size: 3.2rem;
    color: var(--primary-color);
    text-align: center;
    margin: 0 0 5px;
    font-weight: 700;
  }

  h2.main-header-english {
    font-family: 'Playfair Display', serif;
    font-weight: 700;
    font-size: 1.8rem;
    color: var(--secondary-color);
    text-align: center;
    margin: 0 0 35px;
    letter-spacing: 1.5px;
  }

  /* --- Progress Indicator --- */
  .progress-indicator {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 40px;
    position: relative;
    padding-top: 15px; /* Space for the line */
  }

  .progress-line {
    position: absolute;
    top: 25px; /* Aligns with middle of dots */
    left: 10%;
    right: 10%;
    height: 3px;
    background-color: var(--border-color);
    z-index: 0;
  }

  .progress-line-fill {
    height: 100%;
    width: 0;
    background-color: var(--accent-color);
    transition: width 0.4s ease-out;
  }

  .progress-dot {
    width: 14px;
    height: 14px;
    background-color: var(--border-color);
    border-radius: 50%;
    position: relative;
    z-index: 1;
    transition: background-color 0.3s ease, transform 0.3s ease;
    border: 2px solid var(--card-bg-gradient-start); /* to make it stand out on the line */
  }

  .progress-dot.active {
    background-color: var(--accent-color);
    transform: scale(1.2);
  }
  .progress-dot.completed {
    background-color: var(--primary-color);
  }

  /* --- Form Steps --- */
  .step {
    display: none;
    animation: fadeInSlide 0.6s ease-out forwards;
    padding-top: 20px; /* Space from progress indicator */
  }
  .step.active {
    display: block;
  }

  @keyframes fadeInSlide {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }

  label {
    font-weight: 600;
    display: block;
    margin-bottom: 10px;
    font-size: 1.05rem;
    color: var(--primary-color);
  }

  input[type="text"], select, textarea {
    width: 100%;
    padding: 12px 16px;
    font-size: 1.05rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: #fdfdfd;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    margin-bottom: 20px;
  }
  input[type="text"]:focus,
  select:focus,
  textarea:focus {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 3px rgba(226, 165, 0, 0.2);
    outline: none;
  }

  /* Radio & Checkbox Styling */
  .radio-group, .traits-list {
    margin-bottom: 25px;
  }
  .radio-label, .traits-list label {
    display: flex;
    align-items: center;
    cursor: pointer;
    user-select: none;
    margin-bottom: 12px;
    font-weight: 500;
    color: var(--text-color);
  }
  input[type="radio"], input[type="checkbox"] {
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid var(--secondary-color);
    border-radius: 50%; /* for radio */
    margin-right: 10px;
    position: relative;
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
  }
  input[type="checkbox"] {
    border-radius: 4px; /* for checkbox */
  }
  input[type="radio"]:checked::before {
    content: '';
    width: 10px;
    height: 10px;
    background-color: var(--accent-color);
    border-radius: 50%;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
  }
  input[type="checkbox"]:checked::before {
    content: '\2713'; /* Checkmark character */
    font-size: 14px;
    color: var(--card-bg-gradient-start);
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
  }
  input[type="radio"]:checked, input[type="checkbox"]:checked {
    border-color: var(--accent-color);
    background-color: var(--accent-color);
  }
  input[type="radio"]:focus, input[type="checkbox"]:focus {
    outline: 2px solid var(--accent-color);
    outline-offset: 2px;
  }

  /* Buttons */
  .btn-group {
    margin-top: 30px;
    display: flex;
    justify-content: space-between;
    gap: 15px;
  }
  button {
    background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 30px;
    font-weight: 700;
    font-size: 1.05rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }
  button:disabled {
    background: #cccccc;
    box-shadow: none;
    cursor: not-allowed;
    transform: none;
  }
  button:hover:not(:disabled) {
    background: linear-gradient(135deg, var(--accent-color) 0%, var(--light-accent-color) 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
  }
  button[id^="prevBtn"] {
    background: none;
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
    box-shadow: none;
  }
  button[id^="prevBtn"]:hover:not(:disabled) {
    background: var(--primary-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }

  /* Profile image preview */
  #profilePicInput {
    margin-bottom: 10px;
  }
  #profilePicPreview {
    display: block;
    width: 150px;
    height: 150px;
    border-radius: 50%;
    margin: 20px auto 25px;
    border: 5px solid var(--accent-color);
    object-fit: cover;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  #profilePicPlaceholder {
    width: 150px;
    height: 150px;
    background-color: var(--border-color);
    border-radius: 50%;
    margin: 20px auto 25px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text-muted);
    font-size: 4rem;
    border: 5px solid var(--border-color);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  #profilePicPlaceholder i {
    color: var(--secondary-color);
  }

  /* --- Final Card Container --- */
  #finalCard {
    display: none;
    background: linear-gradient(to bottom right, var(--card-bg-gradient-start), var(--card-bg-gradient-end));
    background-image: var(--islamic-pattern), linear-gradient(to bottom right, var(--card-bg-gradient-start), var(--card-bg-gradient-end)); /* Pattern first */
    background-size: 20px 20px, 100% 100%; /* Size of pattern, then gradient */
    background-blend-mode: overlay; /* Blend pattern subtly */
    opacity: 0.1; /* Initial opacity for pattern blend */
    background-repeat: repeat;

    border-radius: 20px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    padding: 40px;
    text-align: center;
    position: relative;
    overflow: hidden;
    border: 2px solid var(--light-accent-color);
    animation: cardAppear 0.8s ease-out forwards;
    /* The opacity is handled separately for the pattern via background-blend-mode */
  }

  @keyframes cardAppear {
    from {opacity: 0; transform: scale(0.9) translateY(20px);}
    to {opacity: 1; transform: scale(1) translateY(0);}
  }
  
  /* Card specific headers (ana muslim and Name's Identity Card) */
  #finalCard .card-title-arabic {
    font-family: 'Scheherazade New', serif;
    font-size: 2rem; /* Little smaller */
    color: var(--secondary-color); /* Different color */
    margin-bottom: 5px;
    line-height: 1.2;
  }
  #finalCard .card-title-english {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem; /* Little smaller */
    color: var(--text-muted); /* Different color */
    margin-bottom: 25px; /* Space before profile section */
  }

  /* Profile section on final card */
  .final-profile-section {
    display: flex;
    flex-direction: column;
    align-items: center; /* Center align pic and name */
    margin-bottom: 35px;
  }

  #finalProfilePic {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    border: 6px solid var(--accent-color);
    object-fit: cover;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
  #finalProfilePicPlaceholder {
    width: 160px;
    height: 160px;
    background-color: var(--border-color);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text-muted);
    font-size: 4.5rem;
    border: 6px solid var(--accent-color);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
  #finalProfilePicPlaceholder i {
    color: var(--secondary-color);
  }

  #finalUserName { /* Styling for the name below the picture */
    font-family: 'Playfair Display', serif;
    font-size: 2.2rem; /* Adjusted dynamically by JS based on length */
    font-weight: 700;
    color: var(--primary-color);
    margin-top: 20px; /* Space between pic and name */
    letter-spacing: 1px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
    white-space: nowrap; /* Prevent name from wrapping prematurely */
    overflow: hidden; /* Hide overflow if name is too long */
    text-overflow: ellipsis; /* Add ellipsis if name is too long */
    max-width: 100%; /* Ensure it respects parent width */
  }

  /* Info Grid Layout */
  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
    text-align: left;
    padding: 0 10px;
  }

  .info-item {
    background: #fdfdfd;
    border: 1px solid var(--border-color);
    border-left: 5px solid var(--accent-color);
    border-radius: 10px;
    padding: 15px 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .info-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  }

  .info-label {
    font-weight: 700;
    color: var(--secondary-color);
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .info-label i {
    margin-right: 8px;
    color: var(--accent-color);
    font-size: 1.1em;
  }
  .info-value {
    color: var(--primary-color);
    font-weight: 600;
    font-size: 1.1rem;
    word-wrap: break-word;
    width: 100%;
  }

  /* Heartfelt message */
  #heartfeltMessage {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: 1.15rem;
    color: var(--text-muted);
    margin-bottom: 45px;
    padding: 20px 30px;
    background: #fdfdfd;
    border-radius: 12px;
    border: 1px dashed var(--border-color);
    line-height: 1.8;
  }
  #heartfeltMessage a {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: 700;
    transition: color 0.2s ease;
  }
  #heartfeltMessage a:hover {
    color: var(--primary-color);
    text-decoration: underline;
  }

  /* Footer credit on card */
  #finalCardFooter {
    position: absolute; /* Kept absolute for original display */
    bottom: 15px;
    left: 0;
    right: 0;
    font-size: 0.85rem;
    color: var(--text-muted);
    font-family: 'Montserrat', sans-serif;
    text-align: center;
  }
  #finalCardFooter a {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s ease;
  }
  #finalCardFooter a:hover {
    color: var(--primary-color);
    text-decoration: underline;
  }

  /* Share options (outside the capturable card for image generation) */
  #shareControls {
    margin-top: 30px;
    text-align: center;
  }

  .share-button-group {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
  }

  .share-button-group a, .share-button-group button {
    background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
    color: white;
    text-decoration: none;
    padding: 10px 18px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 1rem;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    border: none;
    cursor: pointer;
  }
  .share-button-group a:hover, .share-button-group button:hover {
    background: linear-gradient(135deg, var(--accent-color) 0%, var(--light-accent-color) 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  }
  .share-button-group a i, .share-button-group button i {
    font-size: 1.2em;
  }
  #downloadCardBtn { margin-bottom: 15px; } /* Space between Download and Share button */

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    main {
      padding: 30px;
    }
    h1.main-header-arabic {
      font-size: 2.8rem;
    }
    h2.main-header-english {
      font-size: 1.4rem;
    }
    #finalCard .card-title-arabic {
      font-size: 1.8rem;
    }
    #finalCard .card-title-english {
      font-size: 1.1rem;
    }
    #finalUserName {
      font-size: 1.8rem;
    }
    .progress-indicator {
      gap: 10px;
    }
    .progress-dot {
      width: 12px;
      height: 12px;
    }
    .info-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    #finalProfilePic, #finalProfilePicPlaceholder {
      width: 130px;
      height: 130px;
    }
    #heartfeltMessage {
      font-size: 1rem;
      padding: 15px 20px;
    }
    .share-button-group a, .share-button-group button {
      padding: 8px 12px;
      font-size: 0.9rem;
    }
  }

  @media (max-width: 480px) {
    main {
      padding: 20px;
      box-shadow: 0 8px 20px var(--shadow-color);
    }
    h1.main-header-arabic {
      font-size: 2.2rem;
    }
    h2.main-header-english {
      font-size: 1.2rem;
      margin-bottom: 25px;
    }
    .progress-line, .progress-line-fill {
      display: none;
    }
    .progress-indicator {
      gap: 8px;
    }
    label {
      font-size: 0.95rem;
    }
    input[type="text"], select, textarea {
      padding: 10px 14px;
      font-size: 0.95rem;
    }
    .btn-group {
      flex-direction: column;
      gap: 10px;
    }
    button {
      width: 100%;
      padding: 10px 20px;
      font-size: 1rem;
    }
    #finalProfilePic, #finalProfilePicPlaceholder {
      width: 100px;
      height: 100px;
      border-width: 4px;
    }
    #finalUserName {
      font-size: 1.6rem;
    }
    .info-item {
      padding: 12px 15px;
    }
    .info-label {
      font-size: 0.9rem;
    }
    .info-value {
      font-size: 1rem;
    }
    #heartfeltMessage {
      font-size: 0.95rem;
      padding: 12px 15px;
    }
    .share-button-group {
      gap: 10px;
      flex-direction: column;
    }
    .share-button-group a, .share-button-group button {
      width: 80%;
      margin: 0 auto;
      justify-content: center;
    }
  }
</style>
</head>
<body>

<main>
  <h1 class="main-header-arabic">أَنَا مُسْلِمٌ</h1>
  <h2 class="main-header-english">My Muslim Identity Card Generator</h2>

  <!-- Progress Indicator -->
  <div class="progress-indicator" id="progressIndicator">
    <div class="progress-line"><div class="progress-line-fill" id="progressLineFill"></div></div>
    <!-- Dots will be generated by JS -->
  </div>

  <!-- Step Form -->
  <form id="cardForm" novalidate>
    <!-- Step 1: Name -->
    <section class="step active" data-step="1">
      <label for="nameInput">Enter Your Name</label>
      <input type="text" id="nameInput" placeholder="e.g. Ahmad" required autofocus />
      <div class="btn-group">
        <div></div>
        <button type="button" id="nextBtn1" disabled>Next <i class="fas fa-arrow-right"></i></button>
      </div>
    </section>

    <!-- Step 2: Meaning -->
    <section class="step" data-step="2">
      <label for="meaningInput">Enter the Meaning of Your Name</label>
      <textarea id="meaningInput" rows="2" placeholder="e.g. Highly praised, worthy of praise" required></textarea>
      <div class="btn-group">
        <button type="button" id="prevBtn2"><i class="fas fa-arrow-left"></i> Previous</button>
        <button type="button" id="nextBtn2" disabled>Next <i class="fas fa-arrow-right"></i></button>
      </div>
    </section>

    <!-- Step 3: Mentioned in Quran -->
    <section class="step" data-step="3">
      <label>Is Your Name Mentioned in the Quran?</label>
      <div class="radio-group" id="quranMentionGroup">
        <label class="radio-label"><input type="radio" name="mentionedInQuran" value="Yes" /> Yes</label>
        <label class="radio-label"><input type="radio" name="mentionedInQuran" value="No" /> No</label>
      </div>
      <div class="btn-group">
        <button type="button" id="prevBtn3"><i class="fas fa-arrow-left"></i> Previous</button>
        <button type="button" id="nextBtn3" disabled>Next <i class="fas fa-arrow-right"></i></button>
      </div>
    </section>

    <!-- Step 4: Gender -->
    <section class="step" data-step="4">
      <label for="genderSelect">Select Your Gender</label>
      <select id="genderSelect" required>
        <option value="">-- Select Gender --</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
      <div class="btn-group">
        <button type="button" id="prevBtn4"><i class="fas fa-arrow-left"></i> Previous</button>
        <button type="button" id="nextBtn4" disabled>Next <i class="fas fa-arrow-right"></i></button>
      </div>
    </section>

    <!-- Step 5: Islamic Role -->
    <section class="step" data-step="5">
      <label for="roleSelect">Select Your Islamic Role</label>
      <select id="roleSelect" required>
        <option value="">-- Select Role --</option>
        <option value="Ashiq-e-Rasool ﷺ">Ashiq-e-Rasool ﷺ (Lover of the Prophet)</option>
        <option value="True Believer (Mumin)">True Believer (Mumin)</option>
        <option value="Islamic Warrior (of Truth)">Islamic Warrior (of Truth)</option>
        <option value="Guardian of Haya (Modesty)">Guardian of Haya (Modesty)</option>
        <option value="Ummati of Prophet Muhammad ﷺ">Ummati of Prophet Muhammad ﷺ</option>
        <option value="Servant of Allah (SWT)">Servant of Allah (SWT)</option>
        <option value="Seeker of Knowledge">Seeker of Knowledge</option>
        <option value="Da'ee (Caller to Islam)">Da'ee (Caller to Islam)</option>
        <option value="Musafir (Traveler on Earth)">Musafir (Traveler on Earth)</option>
        <option value="Protector of Justice">Protector of Justice</option>
        <option value="Spreader of Peace">Spreader of Peace</option>
        <option value="Other">Other (Type below)</option>
      </select>
      <input type="text" id="customRoleInput" placeholder="Type your custom role" style="display:none; margin-top:10px;" />
      <div class="btn-group">
        <button type="button" id="prevBtn5"><i class="fas fa-arrow-left"></i> Previous</button>
        <button type="button" id="nextBtn5" disabled>Next <i class="fas fa-arrow-right"></i></button>
      </div>
    </section>

    <!-- Step 6: Spiritual Traits -->
    <section class="step" data-step="6">
      <label>Select Your Spiritual Traits (Choose one or more)</label>
      <div class="traits-list" id="traitsContainer">
        <label><input type="checkbox" value="Patient" /> Patient</label>
        <label><input type="checkbox" value="Forgiving" /> Forgiving</label>
        <label><input type="checkbox" value="Trustworthy" /> Trustworthy</label>
        <label><input type="checkbox" value="Generous" /> Generous</label>
        <label><input type="checkbox" value="Humble" /> Humble</label>
        <label><input type="checkbox" value="Truthful" /> Truthful</label>
        <label><input type="checkbox" value="Kind" /> Kind</label>
        <label><input type="checkbox" value="Brave" /> Brave</label>
        <label><input type="checkbox" value="Righteous" /> Righteous</label>
        <label><input type="checkbox" value="Pious" /> Pious</label>
        <label><input type="checkbox" value="Grateful" /> Grateful</label>
        <label><input type="checkbox" value="Just" /> Just</label>
      </div>
      <div class="btn-group">
        <button type="button" id="prevBtn6"><i class="fas fa-arrow-left"></i> Previous</button>
        <button type="button" id="nextBtn6" disabled>Next <i class="fas fa-arrow-right"></i></button>
      </div>
    </section>

    <!-- Step 7: Favorite Quran Verse -->
    <section class="step" data-step="7">
      <label for="verseSelect">Select Your Favorite Quran Verse</label>
      <select id="verseSelect" required>
        <option value="">-- Select a Verse --</option>
        <option value="Indeed, with hardship comes ease. (94:6)">Indeed, with hardship comes ease. (94:6)</option>
        <option value="So remember Me; I will remember you. (2:152)">So remember Me; I will remember you. (2:152)</option>
        <option value="And He is with you wherever you are. (57:4)">And He is with you wherever you are. (57:4)</option>
        <option value="Indeed, Allah loves those who are constantly repentant and loves those who purify themselves. (2:222)">Indeed, Allah loves those who are constantly repentant. (2:222)</option>
        <option value="Our Lord, give us in this world [that which is] good and in the Hereafter [that which is] good and protect us from the punishment of the Fire. (2:201)">Our Lord, give us in this world [that which is] good... (2:201)</option>
        <option value="And rely upon Allah; and sufficient is Allah as Disposer of affairs. (33:3)">And rely upon Allah; and sufficient is Allah. (33:3)</option>
        <option value="Indeed, my Lord is near and responsive. (11:61)">Indeed, my Lord is near and responsive. (11:61)</option>
        <option value="And put your trust in the Almighty, the Most Merciful. (26:217)">And put your trust in the Almighty, the Most Merciful. (26:217)</option>
        <option value="Verily, in the remembrance of Allah do hearts find tranquility. (13:28)">Verily, in the remembrance of Allah do hearts find tranquility. (13:28)</option>
        <option value="And Allah would not punish them while they seek forgiveness. (8:33)">And Allah would not punish them while they seek forgiveness. (8:33)</option>
        <option value="But perhaps you hate a thing and it is good for you; and perhaps you love a thing and it is bad for you. (2:216)">But perhaps you hate a thing and it is good for you. (2:216)</option>
        <option value="No soul knows what has been hidden for them of comfort for eyes as reward for what they used to do. (32:17)">No soul knows what has been hidden for them of comfort for eyes. (32:17)</option>
        <option value="Say, 'He is Allah, [who is] One, Allah, the Eternal Refuge.' (112:1-2)">Say, 'He is Allah, [who is] One...' (112:1-2)</option>
        <option value="And it is He who made the night and the day and the sun and the moon, all [moving] in an orbit. (21:33)">And it is He who made the night and the day. (21:33)</option>
        <option value="So fear Allah as much as you are able and listen and obey and spend [in His cause]; it is better for your souls. (64:16)">So fear Allah as much as you are able. (64:16)</option>
        <option value="And do not despair of the mercy of Allah. Indeed, no one despairs of the mercy of Allah except for the disbelieving people. (12:87)">And do not despair of the mercy of Allah. (12:87)</option>
        <option value="Indeed, Allah is with the patient. (2:153)">Indeed, Allah is with the patient. (2:153)</option>
        <option value="And your Lord is going to give you, and you will be satisfied. (93:5)">And your Lord is going to give you, and you will be satisfied. (93:5)</option>
        <option value="Our Lord, do not let our hearts deviate after You have guided us and grant us from Yourself mercy. Indeed, You are the Bestower. (3:8)">Our Lord, do not let our hearts deviate... (3:8)</option>
        <option value="The most beloved of deeds to Allah are those that are most consistent, even if it is small. (Hadith Qudsi, related to deeds)">The most beloved of deeds to Allah... (Hadith)</option>
        <option value="Add Custom Verse">-- Add Custom Verse --</option>
      </select>
      <textarea id="customVerseInput" rows="2" placeholder="Type your custom verse here" style="display:none; margin-top:10px;"></textarea>
      <div class="btn-group">
        <button type="button" id="prevBtn7"><i class="fas fa-arrow-left"></i> Previous</button>
        <button type="button" id="nextBtn7" disabled>Next <i class="fas fa-arrow-right"></i></button>
      </div>
    </section>

    <!-- Step 8: Upload Profile Image -->
    <section class="step" data-step="8">
      <label for="profilePicInput">Upload Your Profile Picture (optional)</label>
      <input type="file" id="profilePicInput" accept="image/*" />
      <img id="profilePicPreview" alt="Profile Preview" style="display:none" />
      <div id="profilePicPlaceholder" style="display:flex;"><i class="fas fa-user"></i></div>

      <div class="btn-group">
        <button type="button" id="prevBtn8"><i class="fas fa-arrow-left"></i> Previous</button>
        <button type="button" id="generateCard">Generate Card <i class="fas fa-magic"></i></button>
      </div>
    </section>
  </form>

  <!-- Final Card (This is the element that will be visually displayed and then captured) -->
  <section id="finalCard" aria-live="polite">
    <h3 class="card-title-arabic">أَنَا مُسْلِمٌ</h3>
    <p class="card-title-english" id="finalCardSubtitle"></p>

    <div class="final-profile-section">
      <img id="finalProfilePic" alt="Profile Picture" src="" style="display:none" />
      <div id="finalProfilePicPlaceholder" style="display:flex;"><i class="fas fa-user"></i></div>
      <h2 id="finalUserName"></h2>
    </div>

    <div class="info-grid" id="finalInfoGrid">
      <!-- Categories inserted dynamically here -->
    </div>

    <div id="heartfeltMessage">
      "Indeed, Allah is with those who fear Him and those who are doers of good." <br />– Quran 16:128
      <br /><br />
      Created with <i class="fas fa-heart" style="color: var(--accent-color);"></i> by <a href="https://www.islamicpedia.blog" target="_blank" rel="noopener noreferrer">Islamicpedia.blog</a>
    </div>

    <div id="finalCardFooter">
      © 2025 Islamicpedia.blog — All rights reserved.
    </div>
  </section>

  <!-- Share options outside the capturable card to prevent their inclusion in the image -->
  <div id="shareControls" style="display:none; margin-top: 30px; text-align: center;">
      <button id="downloadCardBtn" class="share-button-group" style="margin-bottom: 15px;"><i class="fas fa-download"></i> Download Card</button>
      <button id="shareNativeBtn" class="share-button-group"><i class="fas fa-share-alt"></i> Share Card</button>
      <div class="share-button-group" id="fallbackShareButtons" style="margin-top: 20px; display: none;">
        <a href="#" id="shareWhatsApp" target="_blank" rel="noopener noreferrer" aria-label="Share on WhatsApp"><i class="fab fa-whatsapp"></i> WhatsApp</a>
        <a href="#" id="shareFacebook" target="_blank" rel="noopener noreferrer" aria-label="Share on Facebook"><i class="fab fa-facebook-f"></i> Facebook</a>
        <a href="#" id="shareTelegram" target="_blank" rel="noopener noreferrer" aria-label="Share on Telegram"><i class="fab fa-telegram-plane"></i> Telegram</a>
        <a href="#" id="shareX" target="_blank" rel="noopener noreferrer" aria-label="Share on X (Twitter)"><i class="fab fa-x-twitter"></i> X (Twitter)</a>
        <a href="#" id="shareSnapchat" target="_blank" rel="noopener noreferrer" aria-label="Share on Snapchat"><i class="fab fa-snapchat-ghost"></i> Snapchat</a>
      </div>
  </div>
</main>

<!-- html2canvas library for screenshotting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
(() => {
  // --- Elements ---
  const steps = document.querySelectorAll('.step');
  const totalSteps = steps.length;
  let currentStepIndex = 0;

  // Form inputs
  const nameInput = document.getElementById('nameInput');
  const meaningInput = document.getElementById('meaningInput');
  const quranRadios = document.getElementsByName('mentionedInQuran');
  const genderSelect = document.getElementById('genderSelect');
  const roleSelect = document.getElementById('roleSelect');
  const customRoleInput = document.getElementById('customRoleInput');
  const traitsCheckboxes = document.querySelectorAll('#traitsContainer input[type="checkbox"]');
  const verseSelect = document.getElementById('verseSelect');
  const customVerseInput = document.getElementById('customVerseInput');
  const profilePicInput = document.getElementById('profilePicInput');
  const profilePicPreview = document.getElementById('profilePicPreview');
  const profilePicPlaceholder = document.getElementById('profilePicPlaceholder');

  // Buttons
  const nextBtn1 = document.getElementById('nextBtn1');
  const nextBtn2 = document.getElementById('nextBtn2');
  const nextBtn3 = document.getElementById('nextBtn3');
  const nextBtn4 = document.getElementById('nextBtn4');
  const nextBtn5 = document.getElementById('nextBtn5');
  const nextBtn6 = document.getElementById('nextBtn6');
  const nextBtn7 = document.getElementById('nextBtn7');
  const generateCardBtn = document.getElementById('generateCard');

  const prevBtn2 = document.getElementById('prevBtn2');
  const prevBtn3 = document.getElementById('prevBtn3');
  const prevBtn4 = document.getElementById('prevBtn4');
  const prevBtn5 = document.getElementById('prevBtn5');
  const prevBtn6 = document.getElementById('prevBtn6');
  const prevBtn7 = document.getElementById('prevBtn7');
  const prevBtn8 = document.getElementById('prevBtn8');

  const cardForm = document.getElementById('cardForm');
  const finalCard = document.getElementById('finalCard'); // The actual card element on the page
  const shareControls = document.getElementById('shareControls'); // New container for share buttons

  // Final card content elements
  const finalCardSubtitle = document.getElementById('finalCardSubtitle');
  const finalUserName = document.getElementById('finalUserName');
  const finalProfilePic = document.getElementById('finalProfilePic');
  const finalProfilePicPlaceholder = document.getElementById('finalProfilePicPlaceholder');
  const finalInfoGrid = document.getElementById('finalInfoGrid');

  // Share buttons
  const downloadCardBtn = document.getElementById('downloadCardBtn');
  const shareNativeBtn = document.getElementById('shareNativeBtn');
  const fallbackShareButtons = document.getElementById('fallbackShareButtons');

  // Progress Indicator
  const progressIndicator = document.getElementById('progressIndicator');
  const progressLineFill = document.getElementById('progressLineFill');

  // --- Helper Functions ---

  function initializeProgressDots() {
    for (let i = 0; i < totalSteps; i++) {
      const dot = document.createElement('div');
      dot.classList.add('progress-dot');
      dot.setAttribute('data-step-index', i);
      progressIndicator.appendChild(dot);
    }
  }

  function updateProgressIndicator() {
    const dots = document.querySelectorAll('.progress-dot');
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentStepIndex);
      dot.classList.toggle('completed', index < currentStepIndex);
    });

    const progressPercentage = (currentStepIndex / (totalSteps - 1)) * 100;
    progressLineFill.style.width = `${progressPercentage}%`;
  }

  function showStep(index) {
    steps.forEach((step, i) => {
      step.classList.remove('active');
      if (i === index) {
        step.classList.add('active');
      }
    });
    currentStepIndex = index;
    updateButtons();
    updateProgressIndicator();
  }

  function updateButtons() {
    [nextBtn1, nextBtn2, nextBtn3, nextBtn4, nextBtn5, nextBtn6, nextBtn7, generateCardBtn].forEach(btn => {
      if (btn) btn.disabled = true;
    });

    switch (currentStepIndex) {
      case 0:
        if (nameInput.value.trim()) nextBtn1.disabled = false;
        break;
      case 1:
        if (meaningInput.value.trim()) nextBtn2.disabled = false;
        break;
      case 2:
        if (Array.from(quranRadios).some(r => r.checked)) nextBtn3.disabled = false;
        break;
      case 3:
        if (genderSelect.value) nextBtn4.disabled = false;
        break;
      case 4:
        if (roleSelect.value === "Other") {
          if (customRoleInput.value.trim()) nextBtn5.disabled = false;
        } else {
          if (roleSelect.value) nextBtn5.disabled = false;
        }
        break;
      case 5:
        if (Array.from(traitsCheckboxes).some(chk => chk.checked)) nextBtn6.disabled = false;
        break;
      case 6:
        if (verseSelect.value === "Add Custom Verse") {
          if (customVerseInput.value.trim()) nextBtn7.disabled = false;
        } else {
          if (verseSelect.value) nextBtn7.disabled = false;
        }
        break;
      case 7:
        generateCardBtn.disabled = false;
        break;
    }
  }

  // --- Event Listeners for form inputs ---
  nameInput.addEventListener('input', updateButtons);
  meaningInput.addEventListener('input', updateButtons);
  quranRadios.forEach(r => r.addEventListener('change', updateButtons));
  genderSelect.addEventListener('change', updateButtons);

  roleSelect.addEventListener('change', () => {
    if (roleSelect.value === "Other") {
      customRoleInput.style.display = 'block';
      customRoleInput.focus();
    } else {
      customRoleInput.style.display = 'none';
      customRoleInput.value = '';
    }
    updateButtons();
  });
  customRoleInput.addEventListener('input', updateButtons);

  traitsCheckboxes.forEach(chk => chk.addEventListener('change', updateButtons));

  verseSelect.addEventListener('change', () => {
    if (verseSelect.value === "Add Custom Verse") {
      customVerseInput.style.display = 'block';
      customVerseInput.focus();
    } else {
      customVerseInput.style.display = 'none';
      customVerseInput.value = '';
    }
    updateButtons();
  });
  customVerseInput.addEventListener('input', updateButtons);

  profilePicInput.addEventListener('change', () => {
    const file = profilePicInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        profilePicPreview.src = e.target.result;
        profilePicPreview.style.display = 'block';
        profilePicPlaceholder.style.display = 'none';
      };
      reader.readAsDataURL(file);
    } else {
      profilePicPreview.style.display = 'none';
      profilePicPreview.src = '';
      profilePicPlaceholder.style.display = 'flex';
    }
    updateButtons();
  });

  // --- Navigation Buttons ---
  nextBtn1.addEventListener('click', () => showStep(1));
  nextBtn2.addEventListener('click', () => showStep(2));
  nextBtn3.addEventListener('click', () => showStep(3));
  nextBtn4.addEventListener('click', () => showStep(4));
  nextBtn5.addEventListener('click', () => showStep(5));
  nextBtn6.addEventListener('click', () => showStep(6));
  nextBtn7.addEventListener('click', () => showStep(7));

  prevBtn2.addEventListener('click', () => showStep(0));
  prevBtn3.addEventListener('click', () => showStep(1));
  prevBtn4.addEventListener('click', () => showStep(2));
  prevBtn5.addEventListener('click', () => showStep(3));
  prevBtn6.addEventListener('click', () => showStep(4));
  prevBtn7.addEventListener('click', () => showStep(5));
  prevBtn8.addEventListener('click', () => showStep(6));

  // --- Generate Card ---
  generateCardBtn.addEventListener('click', e => {
    e.preventDefault();

    // Gather data
    const name = nameInput.value.trim();
    const meaning = meaningInput.value.trim() || "Not specified";
    const quranMention = Array.from(quranRadios).find(r => r.checked)?.value || "Not specified";
    const gender = genderSelect.value || "Not specified";

    let role = roleSelect.value;
    if (role === "Other") role = customRoleInput.value.trim() || "Not specified";
    else if (!role) role = "Not specified";

    const traits = Array.from(traitsCheckboxes)
      .filter(chk => chk.checked)
      .map(chk => chk.value);
    const traitsText = traits.length > 0 ? traits.join(', ') : "Not specified";

    let verse = verseSelect.value;
    if (verse === "Add Custom Verse") verse = customVerseInput.value.trim() || "Not specified";
    else if (!verse) verse = "Not specified";

    const profilePicSrc = profilePicPreview.src || "";

    // Clear previous info
    finalInfoGrid.innerHTML = "";

    // Set final card content
    finalCardSubtitle.textContent = `${name || 'Your'}'s Identity Card`;
    finalUserName.textContent = name || "Muslim Believer"; // Default name if empty
    // Adjust font size based on name length for better fit
    const nameLength = (name || "Muslim Believer").length;
    let nameFontSize = '2.2rem'; // Base size
    if (nameLength > 10) nameFontSize = '2rem';
    if (nameLength > 15) nameFontSize = '1.8rem';
    if (nameLength > 20) nameFontSize = '1.6rem';
    finalUserName.style.fontSize = nameFontSize;


    if (profilePicSrc) {
      finalProfilePic.src = profilePicSrc;
      finalProfilePic.style.display = "block";
      finalProfilePicPlaceholder.style.display = "none";
    } else {
      finalProfilePic.style.display = "none";
      finalProfilePicPlaceholder.style.display = "flex";
    }

    // Function to create info items for the grid
    function createInfoItem(label, iconClass, value) {
      const item = document.createElement('div');
      item.className = 'info-item';
      item.innerHTML = `
        <span class="info-label"><i class="${iconClass}"></i> ${label}</span>
        <span class="info-value">${value}</span>
      `;
      return item;
    }

    finalInfoGrid.appendChild(createInfoItem('Meaning of Name', 'fas fa-lightbulb', meaning));
    finalInfoGrid.appendChild(createInfoItem('Quran Mention', 'fas fa-quran', quranMention));
    finalInfoGrid.appendChild(createInfoItem('Gender', 'fas fa-venus-mars', gender));
    finalInfoGrid.appendChild(createInfoItem('Role', 'fas fa-mosque', role));
    finalInfoGrid.appendChild(createInfoItem('Traits', 'fas fa-star', traitsText));
    finalInfoGrid.appendChild(createInfoItem('Favorite Verse', 'fas fa-book-open', verse));

    // Show final card, hide form and display share controls
    cardForm.style.display = 'none';
    finalCard.style.display = 'block';
    shareControls.style.display = 'block';

    // Scroll to final card
    finalCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });

  // --- Image Generation & Sharing ---

  const shareMessage = "Assalamu Alaikum! Check out my personalized Muslim Identity Card 🤗! Made with ❤️ on IslamicPedia.blog";
  const shareUrl = window.location.href;

  async function generateCardImage() {
    // Create a temporary wrapper for the finalCard for accurate capture
    // This wrapper mimics the visual style needed for html2canvas
    const tempCardWrapper = document.createElement('div');
    const rootStyles = getComputedStyle(document.documentElement);
    tempCardWrapper.style.cssText = `
        position: absolute;
        left: -9999px;
        top: -9999px;
        width: 600px; /* Base width for internal elements rendering, html2canvas scales it */
        background: linear-gradient(to bottom right, ${rootStyles.getPropertyValue('--card-bg-gradient-start')}, ${rootStyles.getPropertyValue('--card-bg-gradient-end')});
        background-image: ${rootStyles.getPropertyValue('--islamic-pattern')}, linear-gradient(to bottom right, ${rootStyles.getPropertyValue('--card-bg-gradient-start')}, ${rootStyles.getPropertyValue('--card-bg-gradient-end')});
        background-size: 20px 20px, 100% 100%;
        background-blend-mode: overlay;
        opacity: ${rootStyles.getPropertyValue('--islamic-pattern-opacity')};
        background-repeat: repeat;
        border-radius: 20px;
        border: 2px solid ${rootStyles.getPropertyValue('--light-accent-color')};
        box-shadow: none; /* Avoid capturing main card's shadow on clone */
        padding: 40px; /* Match finalCard padding */
    `;

    const cardClone = finalCard.cloneNode(true);
    // Adjust cloned card styles to ensure proper rendering for html2canvas
    cardClone.style.animation = 'none'; // Disable animation on clone
    cardClone.style.display = 'block'; // Ensure display is block for capture
    cardClone.style.boxShadow = 'none'; // Remove box-shadow for capture
    cardClone.style.opacity = '1'; // Ensure it's fully opaque for capture
    cardClone.style.background = 'none'; // Remove background from clone, wrapper provides it

    // Remove elements from the clone that shouldn't be in the image
    const clonedFooter = cardClone.querySelector('#finalCardFooter');
    if(clonedFooter) clonedFooter.remove(); // Footer will be redrawn on final canvas

    tempCardWrapper.appendChild(cardClone);
    document.body.appendChild(tempCardWrapper);

    const options = {
        scale: 2, // Higher scale for better resolution (2x current size)
        useCORS: true, // Allow cross-origin images (like external profile pic if not loaded from same domain)
        backgroundColor: null, // Transparent background from html2canvas (will be drawn by canvas later)
        allowTaint: true, // Allows capturing tainted canvases (like if profile pic is from a different origin)
    };

    let capturedCanvas;
    try {
        // Capture the cloned card element
        capturedCanvas = await html2canvas(cardClone, options);
    } catch (error) {
        console.error('Error capturing card:', error);
        alert('Could not generate card image. Please try again.');
        return null;
    } finally {
        document.body.removeChild(tempCardWrapper); // Always clean up the temporary clone and wrapper
    }

    // --- Create a new canvas with 9:16 aspect ratio (1080x1920px) ---
    const targetWidth = 1080;
    const targetHeight = 1920; // 9:16 aspect ratio (1080/9 * 16)

    const finalCanvas = document.createElement('canvas');
    finalCanvas.width = targetWidth;
    finalCanvas.height = targetHeight;
    const finalCtx = finalCanvas.getContext('2d');

    // Fill the background of the target canvas with the subtle pattern and base color
    const bodyStyles = getComputedStyle(document.body);
    finalCtx.fillStyle = bodyStyles.getPropertyValue('--bg-color');
    finalCtx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);

    // Draw the background pattern directly to the canvas
    const patternImg = new Image();
    patternImg.src = rootStyles.getPropertyValue('--islamic-pattern').replace(/url\(['"]?([^'"]+)['"]?\)/, '$1'); // Extract URL from CSS variable
    await new Promise(resolve => {
        patternImg.onload = resolve;
        patternImg.onerror = () => { console.warn('Failed to load pattern image.'); resolve(); }; // Continue even if pattern fails to load
    });

    if (patternImg.complete && patternImg.naturalHeight !== 0) { // Check if image loaded successfully
        const pattern = finalCtx.createPattern(patternImg, 'repeat');
        finalCtx.save();
        finalCtx.globalAlpha = parseFloat(rootStyles.getPropertyValue('--islamic-pattern-opacity')); // Apply opacity
        finalCtx.fillStyle = pattern;
        finalCtx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
        finalCtx.restore();
    }


    // Draw the captured card (from html2canvas) onto the new 9:16 canvas, centered
    const capturedAspectRatio = capturedCanvas.width / capturedCanvas.height;
    const targetAspectRatio = targetWidth / targetHeight;

    let drawWidth = targetWidth;
    let drawHeight = targetHeight;
    let drawX = 0;
    let drawY = 0;

    // Calculate how to fit the captured image into the target aspect ratio
    // This logic aims to contain the full card within the 9:16 frame, adding bars if needed
    if (capturedAspectRatio > targetAspectRatio) {
        // Captured image is wider than target (landscape-like relative to 9:16 portrait)
        // Scale to fit target width, calculate height, center vertically
        drawWidth = targetWidth;
        drawHeight = targetWidth / capturedAspectRatio;
        drawY = (targetHeight - drawHeight) / 2;
    } else {
        // Captured image is taller than target (portrait-like relative to 9:16 portrait)
        // Scale to fit target height, calculate width, center horizontally
        drawHeight = targetHeight;
        drawWidth = targetHeight * capturedAspectRatio;
        drawX = (targetWidth - drawWidth) / 2;
    }

    // Draw the captured content from html2canvas onto the final canvas
    finalCtx.drawImage(capturedCanvas, drawX, drawY, drawWidth, drawHeight);

    // Add the footer text directly to the canvas for precise positioning
    const footerText = `© 2025 Islamicpedia.blog — All rights reserved.`;
    finalCtx.font = '300 28px "Montserrat", sans-serif'; // Font size adjusted for 1920px height
    finalCtx.fillStyle = '#6c757d'; // Use text-muted color
    finalCtx.textAlign = 'center';
    finalCtx.fillText(footerText, targetWidth / 2, targetHeight - 40); // Position near the bottom

    return finalCanvas.toDataURL('image/png');
  }

  downloadCardBtn.addEventListener('click', async () => {
    const imageDataUrl = await generateCardImage();
    if (imageDataUrl) {
      const a = document.createElement('a');
      a.href = imageDataUrl;
      a.download = `Muslim_ID_Card_${nameInput.value.trim().replace(/\s/g, '_') || 'New'}.png`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  });

  shareNativeBtn.addEventListener('click', async () => {
    const imageDataUrl = await generateCardImage();
    if (imageDataUrl) {
      // Convert data URL to Blob for native share
      const response = await fetch(imageDataUrl);
      const blob = await response.blob();
      const file = new File([blob], `Muslim_ID_Card_${nameInput.value.trim().replace(/\s/g, '_') || 'New'}.png`, { type: 'image/png' });

      if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
          await navigator.share({
            title: 'My Muslim Identity Card',
            text: shareMessage,
            url: shareUrl,
            files: [file]
          });
          console.log('Native share successful!');
        } catch (error) {
          console.error('Native share failed:', error);
          // Fallback if native sharing fails or is cancelled
          triggerFallbackShare(shareMessage, shareUrl);
        }
      } else {
        // Fallback for browsers that don't support file sharing via Web Share API
        alert('Your device does not support sharing images directly. You can download the card and share it manually, or use the social media links below.');
        triggerFallbackShare(shareMessage, shareUrl);
      }
    }
  });

  // Fallback share function for social media links
  function triggerFallbackShare(message, url) {
    const encodedMessage = encodeURIComponent(message);
    const encodedUrl = encodeURIComponent(url);

    // Show fallback buttons only if native sharing isn't fully supported
    fallbackShareButtons.style.display = 'flex';

    document.getElementById('shareWhatsApp').href = `https://wa.me/?text=${encodedMessage}%0A${encodedUrl}`;
    document.getElementById('shareFacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}"e=${encodedMessage}`;
    document.getElementById('shareTelegram').href = `https://t.me/share/url?url=${encodedUrl}&text=${encodedMessage}`;
    document.getElementById('shareX').href = `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedMessage}`;
    document.getElementById('shareSnapchat').href = `https://www.snapchat.com/scan?attachmentUrl=${encodedUrl}`;
  }

  // Initial setup
  initializeProgressDots();
  showStep(0);
  updateButtons();

  // Hide native share button and show fallback if not supported on load
  if (!navigator.share || !navigator.canShare || !navigator.canShare({ files: [new File([], 'a.png', { type: 'image/png' })] })) {
    shareNativeBtn.style.display = 'none';
    // No need to show fallback buttons on load, only when user clicks share and native fails
    // fallbackShareButtons.style.display = 'flex'; // Removed this line
  }
})();
</script>

</body>
</html>
